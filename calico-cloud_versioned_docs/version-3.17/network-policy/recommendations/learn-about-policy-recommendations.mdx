---
description: Learn more about policy recommendations.
---

# Learn how to interpret policy recommendation rules

## Big picture

To use the [policy recommendation feature](policy-recommendations.mdx), you must have traffic between endpoints in namespaces, private, public network IPs or domains. In this tutorial we show you how to generate recommendations allowing traffic from to a namespace, a network set, a private network IP and a public domain.

### Configure felix for fast flow logs collection

```bash
kubectl patch felixconfiguration.p default -p '{"spec":{"flowLogsFlushInterval":"10s"}}'
```

### Apply the tutorial YAML, creating the namespaces, deployments, containers, services and global network sets used in this tutorial.

```bash
kubectl create -f {{tutorialFilesURL}}/00-namespace.yaml
```

### Enable Policy Recommendation

1. In the Manager UI left navbar, click on the **Policies** icon.
1. Select **Recommendations**.
1. Click on **Enable Policy Recommendations**.

Wait for the recommendations to be generated. Unless otherwise configured, the recommendations will take at least 2m30s to be generated, time equal to the default **Processing Interval**.

Once ready, the recommendations will be listed in the main **Policy Recommendations** page, under the **Recommendations** tab.

You should find three recommendations:
* `public-domain-curl-namespace-recommendation` in the `public-domain-curl-namespace` namespace 

With selector:
```
Policy Label selector:	[[projectcalico.org/namespace == 'public-domain-curl-namespace']]
```
meaning that the policy addresses traffic to/from the public-domain-curl-namespace namespace.

You will also find egress rules:
```
Allow:Protocol is TCP
To:Ports [Port is 8080 ]  Domains [www.tigera.io]  

Allow:Protocol is UDP
To:Ports [Port is 53 ]  Endpoints [[projectcalico.org/orchestrator == 'k8s']]  Namespaces [[projectcalico.org/name == 'kube-system']]  

Allow:Protocol is UDP
To:Ports [Port is 53 ]  Nets [Is 10.0.0.0/8 OR Is 172.16.0.0/12 OR Is 192.168.0.0/16 ]  
```

* `service-curl-namespace-recommendation` in namespace `service-curl`

with selector:
```
Policy Label selector:	[[projectcalico.org/namespace == 'service-curl-namespace']]
```

and egress Rules:
```
Allow:Protocol is UDP
To:Ports [Port is 53 ]  Endpoints [[projectcalico.org/orchestrator == 'k8s']]  Namespaces [[projectcalico.org/name == 'kube-system']]  

Allow:Protocol is UDP
To:Ports [Port is 53 ]  Nets [Is 10.0.0.0/8 OR Is 172.16.0.0/12 OR Is 192.168.0.0/16 ]  
```

### Investigate the flows that are used to generate the policy rules

To view flow logs in Service Graph:

1. In the Manager UI left navbar, click **Service Graph**.
1. Select **Default** under the VIEWS option.
1. In the bottom pane you will see flow logs in the Flows tab.

The recommendation engine queries the flow logs and specifically, it queries flows that have been allowed by the default kubernetes policy. Search for flows with policies containing an entry like `*__PROFILE__|__PROFILE__.kns.public-domain-curl|allow*`.

Select to **Filter Flows**

1. Add `source_namespace = "public-domain-curl"`
1. OR dest_domains = "www.projectcalico.org"
1. OR dest_name_aggr = "public-ips"
1. OR dest-namespace = "kube-system"

Each flow was used to generate a specific rule in the `public-domain-curl-recommendation` recommendation (staged network policy).

The flows with `dest_domains = "www.projectcalico.org"` was mapped and generated the rule:
```
Allow:Protocol is TCP
To:Ports [Port is 80 ]  Domains [www.projectcalico.org, www.google.com, www.tigera.io]  
```

The flow with `dest_name_aggr = "public-ips"` was mapped and generated the rule:

```
Allow:Protocol is TCP
To:Ports [Port is 80 ]  Endpoints [[projectcalico.org/name == 'public-ips' and projectcalico.org/kind == 'NetworkSet']]  Namespaces global() 
```

### Why are recommendations not generated, even though there is traffic between endpoints

A recommendation will generate policy rules for flows that are not captured by any other policy in your cluster. Verify that no other enforced policy captures the traffic in question.

### Next step

You are now ready to [enable policy recommendations](policy-recommendations#enable-policy-recommendations) and see flows that can be allowed.
