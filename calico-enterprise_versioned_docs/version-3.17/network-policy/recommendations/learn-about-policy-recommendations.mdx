---
description: Learn more about policy recommendations.
---

# Learn how to interpret policy recommendation rules

## Big picture

To use the [policy recommendation feature](policy-recommendations.mdx), you must have traffic between endpoints. In this tutorial we show you how recommendations are generated using flow logs in your cluster, for traffic to/from namespaces, network sets, a private network IPs and public domains.

### Configure felix for fast flow logs collection

```bash
kubectl patch felixconfiguration.p default -p '{"spec":{"flowLogsFlushInterval":"10s"}}'
```

### Apply the tutorial YAML, creating the necessary resources.

```bash
kubectl create -f {{tutorialFilesURL}}/00-namespace.yaml
```

### Enable Policy Recommendation

1. In the Manager UI left navbar, click on the **Policies** icon.
1. Select **Recommendations**.
1. Click on **Enable Policy Recommendations**.

Wait for the recommendations to be generated. Unless otherwise configured, the recommendations will take at least 2m30s to be generated, time equal to the default [Processing Interval](../../reference/resources/policyrecommendations.mdx#spec).

Once ready, the recommendations will be listed in the main **Policy Recommendations** page, under the **Recommendations** tab.

You should find a recommendation named `curl-ns-recommendation`, with policy selector:
```
Policy Label selector:	[[projectcalico.org/namespace == 'curl-ns']]
```
meaning that the policy addresses traffic to/from the `curl-ns` namespace.

You will also find egress rules:
```
Allow:Protocol is TCP
To:Ports [Port is 8080 ]  Domains [www.tigera.io]  
```
allows egress traffic, for protocol TCP, on port 8080, from the `curl-ns` namespace to domain `www.tigera.io`.

```
Allow:Protocol is UDP
To:Ports [Port is 53 ]  Endpoints [[projectcalico.org/orchestrator == 'k8s']]  Namespaces [[projectcalico.org/name == 'kube-system']]
```
allows egress traffic, for protocol UDP, on port 53, from the `curl-ns` namespace to the `kube-system` namespace.

```
Allow:Protocol is TCP
To:Ports [Port is 80 ]  Endpoints [[projectcalico.org/name == 'public-ips' and projectcalico.org/kind == 'NetworkSet']]  Namespaces global()
```
allows egress traffic, for protocol TCP, on port 80, from the `curl-ns` namespace to IPs defined in the global network set named: `public-ips`.


```
Allow:Protocol is TCP
To:Ports [Port is 8080 ]  Nets [Is 10.0.0.0/8 OR Is 172.16.0.0/12 OR Is 192.168.0.0/16 ]
```
allows egress traffic, for protocol TCP, on port 8080, from the `curl-ns` namespace to private range IPs.

```
Allow:Protocol is TCP
To:Ports [Port is 80 ]
```
allows egress traffic, for protocol TCP, on port 80, from the `curl-ns` namespace to public range IPs.

### Investigate the flows that are used to generate the policy rules

To view flow logs in Service Graph:

1. In the Manager UI left navbar, click **Service Graph**.
1. Select **Default** under the VIEWS option.
1. In the bottom pane you will see flow logs in the Flows tab.

To generate rules, the recommendation engine queries flow logs that have been allowed by the default kubernetes policy. The result of that query expresses traffic in your cluster for which no enforced policy defines a rule for. Subsequently, it uses that information to define the missing rules necessary for allowing the traffic.

To get a better understanding of which flows contributed to generating the rules in your policy.

Select to **Filter Flows**

1. To find the flows that were used to generate the egress to global network set rule, add `source_namespace = "curl-ns" AND  dest_name_aggr = "public-ips"`
1. To find the flows that generated the egress rule to namespace `kube-system`, define query `source_namespace = "curl-ns" AND  dest_namenamespace = "kube-system"`

You'll notice that each of the flow logs contains a field named `policies` with a entry like `1|__PROFILE__|__PROFILE__.kns.curl-ns|allow|0`, meaning that the particular flow was not addressed by any other policy within the cluster.

### Why are recommendations not generated, even though there is traffic between endpoints

A recommendation will generate policy rules for flows that are not captured by any other policy in your cluster. Verify that no other enforced policy captures the traffic in question.

### Next step

You are now ready to [enable policy recommendations](policy-recommendations#enable-policy-recommendations) and see flows that can be allowed.
